<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kuis Interaktif Malbia</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <style>
    body {
      background: linear-gradient(to right, #d4fc79, #96e6a1);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .card {
      background: white;
      border-radius: 1rem;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
  </style>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-analytics.js"></script>
  <script>
    // Konfigurasi Firebase milikmu
    var firebaseConfig = {
      apiKey: "AIzaSyCdEErMVEfKUUFzXgh6hNyJxOGRtx74vF0",
      authDomain: "malbia-indonesia-3b0ac.firebaseapp.com",
      projectId: "malbia-indonesia-3b0ac",
      storageBucket: "malbia-indonesia-3b0ac.firebasestorage.app",
      messagingSenderId: "8912593189",
      appId: "1:8912593189:web:a3c14dbfb699bfed91bacc",
      measurementId: "G-84THN7Y0EW"
    };
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();
    const db = firebase.database();
  </script>
</head>

<body class="min-h-screen flex flex-col items-center justify-start px-4 py-6">
  <div class="card w-full max-w-2xl p-6">
    <h1 class="text-3xl font-bold text-center text-green-700 mb-6">Kuis Interaktif Malbia</h1>
    <div class="grid grid-cols-1 gap-4 mb-6">
      <button onclick="buatSoal()" class="bg-green-600 text-white py-2 rounded">Buat Soal</button>
      <button onclick="kerjakanSoal()" class="bg-green-500 text-white py-2 rounded">Kerjakan Soal</button>
      <button onclick="lihatLaporan()" class="bg-green-400 text-white py-2 rounded">Lihat Laporan</button>
    </div>
    <div id="content" class="bg-green-50 p-4 rounded border border-green-300">
      <p class="text-center text-green-700">Selamat datang di Malbia.id — kuis online buatan Indonesia!</p>
    </div>
  </div>

  <script>
    let soalData = {};
    let laporanData = {};
    let currentKodeSoal = null;

    function simpanSemuaData() {
      if (!currentKodeSoal) return;
      db.ref("soal/" + currentKodeSoal).set(soalData[currentKodeSoal]);
      db.ref("laporan/" + currentKodeSoal).set(laporanData[currentKodeSoal] || []);
    }

    function buatSoal() {
      const kode = prompt("Masukkan kode soal:");
      if (!kode) return;
      currentKodeSoal = kode;
      soalData[kode] = soalData[kode] || [];
      laporanData[kode] = laporanData[kode] || [];

      const pertanyaan = prompt("Tulis pertanyaan:");
      const a = prompt("Pilihan A:");
      const b = prompt("Pilihan B:");
      const c = prompt("Pilihan C:");
      const d = prompt("Pilihan D:");
      const benar = prompt("Jawaban benar (a/b/c/d):");
      const poin = parseInt(prompt("Jumlah poin:"));

      soalData[kode].push({ pertanyaan, opsi: { a, b, c, d }, jawaban: benar, poin });
      simpanSemuaData();
      alert("Soal berhasil ditambahkan!");
    }

    function kerjakanSoal() {
      const kode = prompt("Masukkan kode soal:");
      if (!kode) return;
      currentKodeSoal = kode;

      db.ref("soal/" + kode).once("value").then(snapshot => {
        if (!snapshot.exists()) return alert("Kode soal tidak ditemukan!");
        soalData[kode] = snapshot.val();
        tampilSoal(0, 0);
      });
    }

    function tampilSoal(index, skor) {
      const soal = soalData[currentKodeSoal][index];
      if (!soal) {
        const nama = prompt("Nama kamu:");
        const maks = soalData[currentKodeSoal].reduce((a, b) => a + (b.poin || 0), 0);
        laporanData[currentKodeSoal].push({ nama, skor, maks });
        db.ref("laporan/" + currentKodeSoal).set(laporanData[currentKodeSoal]);
        document.getElementById("content").innerHTML = `<p class="text-green-700">✅ Selesai! Skor kamu: ${skor}/${maks}</p>`;
        return;
      }

      document.getElementById("content").innerHTML = `
        <p class="mb-2 font-bold">${index + 1}. ${soal.pertanyaan}</p>
        ${["a", "b", "c", "d"].map(k => `
          <label><input type="radio" name="jawab" value="${k}"> ${k.toUpperCase()}. ${soal.opsi[k]}</label><br>`).join("")}
        <button onclick="cekJawaban(${index}, ${skor})" class="mt-2 bg-green-700 text-white py-1 px-3 rounded">Jawab</button>
      `;
    }

    function cekJawaban(index, skor) {
      const jawaban = document.querySelector("input[name='jawab']:checked")?.value;
      if (!jawaban) return alert("Pilih jawaban dulu!");

      const soal = soalData[currentKodeSoal][index];
      if (jawaban === soal.jawaban) skor += soal.poin || 0;

      tampilSoal(index + 1, skor);
    }

    function lihatLaporan() {
      const kode = prompt("Masukkan kode soal:");
      if (!kode) return;

      db.ref("laporan/" + kode).once("value").then(snapshot => {
        const data = snapshot.val();
        if (!data || data.length === 0) return alert("Belum ada laporan.");
        let html = `<h2 class="font-bold mb-2">Laporan Kode: ${kode}</h2><ul class="list-disc pl-5">`;
        data.forEach(l => html += `<li>${l.nama}: ${l.skor}/${l.maks}</li>`);
        html += "</ul>";
        document.getElementById("content").innerHTML = html;
      });
    }
  </script>
</body>
</html>
